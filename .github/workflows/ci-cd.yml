name: CI/CD 3-tier

on: [push]

jobs:
  test_backend:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      # ... c√°c b∆∞·ªõc test backend

  test_frontend:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      # ... c√°c b∆∞·ªõc test frontend

  deploy:
    needs: [test_backend, test_frontend]
    runs-on: self-hosted

    # üëá Quan tr·ªçng: d√πng Windows PowerShell 5 thay v√¨ pwsh
    defaults:
      run:
        shell: powershell

    steps:
      - uses: actions/checkout@v4

      - name: Ki·ªÉm tra Docker/Compose
        run: |
          docker --version
          docker compose version

      - name: Validate docker-compose.yml
        run: docker compose config -q

      - name: Deploy b·∫±ng Docker Compose
        run: docker compose -f docker-compose.yml up -d --build

      - name: D·ªçn ·∫£nh c≈© (optional)
        run: docker image prune -f
